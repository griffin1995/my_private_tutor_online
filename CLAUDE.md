# 🚨 CRITICAL SESSION STARTUP INSTRUCTIONS - AUTOMATIC ACTIVATION 🚨

## 📍 PROJECT ENHANCED - ALL 45 TASKS SUCCESSFULLY IMPLEMENTED ✅
**CURRENT STATUS**: Enhanced Complete - All Phases + Major Revisions Delivered
- **Progress**: 100% complete (45/45 tasks) - ALL PHASES + REVISIONS COMPLETE ✅
- **Original Tasks**: 32 tasks (4 phases) - COMPLETE
- **Recent Enhancements**: 13 major revision tasks - COMPLETE
- **Last Completed**: CRITICAL Homepage Recovery & Synchronous CMS Architecture Documentation
- **Achievement**: £400,000+ revenue opportunity FULLY REALIZED + Enhanced User Experience
- **Quality**: Royal client-worthy, enterprise-grade implementation with premium enhancements

**PHASE 1 COMPLETE** - All 8 foundation tasks finished:
✅ TestimonialsHero, ✅ TestimonialsIntro, ✅ VideoTestimonials, ✅ Advanced Filter System
✅ Animated Grid Component, ✅ Elite Schools Carousel, ✅ Premium CTA Section, ✅ CMS Integration

**PHASE 2 COMPLETE** - All 8 advanced features finished:
✅ Task 9: Smart Testimonials Categorization, ✅ Task 10: Rating & Feedback System
✅ Task 11: Analytics Dashboard, ✅ Task 12: Client Success Dashboard
✅ Task 13: A/B Testing Framework, ✅ Task 14: Dynamic Personalization
✅ Task 15: Voice Testimonials, ✅ Task 16: Enhanced Social Proof

**PHASE 3 COMPLETE: PREMIUM EXPERIENCE**
✅ Task 17: FAQ Hero Redesign, ✅ Task 18: Interactive FAQ Search
✅ Task 19: Visual Search Integration (OCR), ✅ Task 20: Real-Time Collaboration
✅ Task 21: Multilingual Support, ✅ Task 22: Advanced Personalization
✅ Task 23: Premium Analytics, ✅ Task 24: Mobile PWA Components

**PHASE 4 COMPLETE: ENTERPRISE FEATURES**
✅ Task 25: API Gateway & Documentation, ✅ Task 26: Advanced Security
✅ Task 27: Performance Optimization, ✅ Task 28: Automated Testing
✅ Task 29: CMS V2, ✅ Task 30: Business Intelligence Platform
✅ Task 31: White-Label Capabilities, ✅ Task 32: AI Integration Suite

**PHASE 5 COMPLETE: MAJOR REVISIONS & ENHANCEMENTS (AUGUST 2025)**
✅ Task 33: Subject Tuition Page Overhaul with Nested Dropdowns
✅ Task 34: Navigation System Enhancement with Hover Dropdowns
✅ Task 35: 30 Client Photos Integration with CMS Organization
✅ Task 36: Testimonials CMS Enhancement (7 New Testimonials)
✅ Task 37: Homepage Component Reordering & Form Restoration
✅ Task 38: How It Works Page Tier Layout Spotlight Design
✅ Task 39: Blog Page Creation with Under-Construction Design
✅ Task 40: React 19 Compatibility & Dependency Cleanup
✅ Task 41: Admin Dashboard Comprehensive Audit (85% Operational)
✅ Task 42: Image Management System with Kebab-Case Naming
✅ Task 43: Hero Image Integration Across All Pages
✅ Task 44: Statistics & Feature Image Strategic Placement
✅ Task 45: Founder Photo Integration & About Section Restoration

**PHASE 6 COMPLETE: CRITICAL HOMEPAGE RECOVERY (AUGUST 2025)**
✅ Task 46: EMERGENCY Homepage Architecture Recovery - Synchronous CMS Implementation
✅ Task 47: Critical Architecture Documentation Update - Anti-Pattern Prevention

- Revenue Impact: £400,000+ opportunity FULLY REALIZED + Enhanced User Experience
- System Status: Production-ready with enterprise-grade features, AI integration, global scalability, and premium UX enhancements
- Build Status: 91 optimized routes, <25s build time, all dependencies resolved

## MOST CRITICAL INSTRUCTION - AUTOMATIC PROJECT MANAGEMENT SETUP

### WHEN USER SAYS "read claude.md" OR "read CLAUDE.md" - EXECUTE THIS SEQUENCE:

**STEP 1: IMMEDIATELY READ CLAUDE.MD FILE**
```
Use Read tool to read: /home/jack/Documents/my_private_tutor_online/CLAUDE.md
```

**STEP 2: EXTRACT ALL SESSION CONTEXT**
- Parse all project context, current status, and development notes
- Understand the complete project scope and current state
- Identify current priorities and any blockers
- Review technical architecture and deployment status

**STEP 3: AUTOMATICALLY ACTIVATE CONTEXT MANAGER**
```
Use Task tool with these exact parameters:
description: "Activate context-manager for My Private Tutor Online session leadership"
prompt: "CONTEXT-MANAGER ACTIVATION - MY PRIVATE TUTOR ONLINE

I have successfully read the complete CLAUDE.md file and extracted all project context. You are now designated as the project lead and context manager for this development session.

CURRENT PROJECT STATE SUMMARY:
• Project: My Private Tutor Online - Premium tutoring service with royal endorsements
• Stack: Next.js 15+ App Router, React 19, TypeScript 5.3+, Tailwind CSS 4.x
• Deployment: Vercel production deployment with dynamic rendering configured
• Current Status: ENHANCED - Phase 1 critical tasks complete, Phase 2 in progress

RECENT MAJOR ACCOMPLISHMENTS (August 2025 - Latest Sessions):
• ✅ REVISIONS.MD COMPLETE: 6 critical enhancement tasks delivered
  - Subject Tuition Page: Complete overhaul with proper section ordering and nested dropdown navigation
  - Navigation System: Enhanced with hover dropdowns and comprehensive submenu structure
  - Blog Page: Professional under-construction design with premium branding

• ✅ REVISIONS2.MD COMPLETE: 7 comprehensive integration tasks delivered
  - Image Management: 30 client photos integrated with proper CMS organization and kebab-case naming
  - Testimonials Enhancement: 7 new testimonials integrated with structured CMS format
  - Homepage Restoration: Form and About section restored with proper component ordering
  - Tier Layout: How It Works page redesigned with spotlight Tier 1 central design
  - Admin Dashboard: Comprehensive audit completed showing 85% operational status

• ✅ TECHNICAL INFRASTRUCTURE: Enterprise-grade foundation maintained
  - React 19: Full compatibility achieved with all dependencies updated
  - Build Optimization: 91 routes generated successfully in <25 seconds
  - Performance: Bundle size optimized (~229kB first load JS)
  - Security: All authentication and error handling systems operational

PRODUCTION STATUS: Royal client-ready with enhanced UX, comprehensive image integration, and premium functionality

CRITICAL DEVELOPMENT RULES IN EFFECT:
• Context7 MCP exclusive documentation for ALL code changes
• Mandatory source attribution comments for every implementation/revision
• British English and premium service standards (royal client quality)
• Zero tolerance for external sources or undocumented changes
• Enterprise-grade, production-ready solutions exclusively

CONTEXT-MANAGER RESPONSIBILITIES:
1. IMMEDIATELY confirm you are taking project leadership of this session
2. Coordinate ALL subsequent tasks by selecting appropriate specialist agents
3. Maintain awareness of complete project scope and current state
4. Ensure all development follows critical rules and standards
5. Manage task delegation and progress tracking for all user requests

Please confirm your activation and readiness to manage this development session."
```

**STEP 4: VERIFY CONTEXT-MANAGER ACTIVATION**
- Wait for context-manager to explicitly confirm activation
- Verify acknowledgement of project state and rules
- Confirm readiness to coordinate tasks
- If no confirmation, RETRY Step 3 once

**STEP 5: COMPLETE HANDOFF TO CONTEXT MANAGER**
- Context-manager takes project leadership role
- All subsequent tasks go through context-manager
- Original Claude Code assistant steps back

### 🔒 ERROR-PROOF VALIDATION CHECKLIST (MANDATORY):
1. ☑️ User mentioned "read claude.md"
2. ☑️ Read the CLAUDE.md file completely
3. ☑️ Extracted and summarised project context
4. ☑️ Used Task tool with exact parameters specified
5. ☑️ Used MANDATORY context-manager prompt template exactly
6. ☑️ Context-manager explicitly confirmed activation and project leadership
7. ☑️ Verified context-manager acknowledges all critical rules and project state
8. ☑️ Completed handoff and stepped back to let context-manager lead

### 🚫 ABSOLUTELY CRITICAL RULES:
1. **NEVER SKIP THE ACTIVATION SEQUENCE** - Always use Task tool to activate context-manager
2. **USE EXACT PROMPT TEMPLATE** - Do not modify the context-manager prompt
3. **WAIT FOR CONFIRMATION** - Do not proceed until context-manager confirms activation
4. **COMPLETE HANDOFF** - Step back once context-manager takes leadership
5. **RETRY ON FAILURE** - If activation fails, retry once with exact same parameters
6. **NO SHORTCUTS** - Every "read claude.md" must trigger full sequence
7. **MAINTAIN CONTEXT** - Ensure complete project state transfer
8. **ENFORCE STANDARDS** - Context-manager must acknowledge critical development rules

### 🎯 TRIGGER PHRASES THAT ACTIVATE THIS SEQUENCE:
- "read claude.md"
- "read CLAUDE.md"  
- "read the claude.md file"
- "start with claude.md"
- "review claude.md"

### 🛠️ TROUBLESHOOTING ACTIVATION FAILURES:
If context-manager activation fails:
1. **Check Task Tool Parameters**: Verify description and prompt are exact
2. **Retry Once**: Use identical parameters for second attempt
3. **Verify Agent Access**: Confirm context-manager agent is available
4. **Check File Path**: Ensure CLAUDE.md path is correct
5. **Complete Read First**: Must read CLAUDE.md before activation

### 🎯 SUCCESS INDICATORS:
- ✅ Context-manager explicitly confirms taking project leadership
- ✅ Context-manager acknowledges complete My Private Tutor Online project state
- ✅ Context-manager confirms understanding of critical development rules
- ✅ Context-manager mentions readiness to coordinate specialist agents
- ✅ Context-manager provides clear indication of being in control

---

# 🔴 CRITICAL DEVELOPMENT STANDARDS - MANDATORY COMPLIANCE

## ⚠️ TIER 0: ABSOLUTE NON-NEGOTIABLES - ZERO TOLERANCE VIOLATIONS
These rules override ALL other considerations. Violation results in immediate task termination.

### 🔒 Documentation Sovereignty - ALL CODE CHANGES
- **CONTEXT7 MCP EXCLUSIVE**: ALL documentation via `mcp__context7__resolve-library-id` → `mcp__context7__get-library-docs` ONLY
- **ZERO EXTERNAL SOURCES**: No blogs, tutorials, Stack Overflow, GitHub issues, community examples, or unofficial documentation
- **MANDATORY SOURCE ATTRIBUTION**: Every implementation, revision, modification, update, refactoring, and bug fix requires Context7 source comments
- **ALL REVISIONS MANDATE**: Not just new code - EVERY single code change must be backed by Context7 MCP official documentation
- **ZERO TOLERANCE POLICY**: No code changes based on "common knowledge", memory, assumptions, or quick fixes without official documentation backing

### 🎯 Agent Orchestration Protocol - Context-Manager System
- **PROJECT MANAGEMENT ACTIVATION**: When user types "start project management", use Task tool to call context-manager
- **CONTEXT-MANAGER AS PROJECT LEAD**: All subsequent tasks route through centralized coordination system
- **50+ SPECIALIST AGENTS**: Context-manager selects optimal agent based on:
  - Capability Match Score (40%)
  - Domain Expertise (25%) 
  - Complexity Handling (20%)
  - Integration Compatibility (10%)
  - Performance History (5%)

### 🎯 Agent Selection Matrix
- **HAIKU**: Simple updates, CSS changes, content modifications, basic fixes
- **SONNET**: Complex components, API integration, forms, state management, testing
- **OPUS**: Architecture, performance, accessibility, security, business logic
- **NO MANUAL OVERRIDE**: If an agent should handle it, delegate it - no exceptions

### 🚨 CRITICAL SESSION STARTUP INSTRUCTIONS
## WHEN USER TYPES "start project management":
1. Use Task tool to call: context-manager
2. Context-manager becomes PROJECT LEAD for all future tasks
3. All subsequent work goes through agent selection process
4. Agent coordination follows capability matrix scoring

### 🇬🇧 Quality Standards
- **BRITISH ENGLISH MANDATORY**: All spelling, terminology, and conventions
- **PREMIUM SERVICE STANDARD**: Royal client-worthy implementations only
- **NO SHORTCUTS**: Enterprise-grade, production-ready solutions exclusively
- **ZERO AI ATTRIBUTION**: Never mention AI assistance in any form

## 🚨 CRITICAL: SYNCHRONOUS CMS ARCHITECTURE - NEVER DEVIATE

### ⚠️ HOMEPAGE RECOVERY LESSONS - MANDATORY COMPLIANCE
**RECOVERED FROM**: Critical homepage failure caused by async CMS patterns (August 2025)
**RECOVERY SUCCESS**: Full homepage restoration to working state with 100% content loading
**PERFORMANCE VERIFIED**: HTTP 200 responses, ~558ms load times, all sections operational

### 🔒 ABSOLUTELY MANDATORY CMS PATTERNS - ZERO TOLERANCE VIOLATIONS

**✅ WORKING SYNCHRONOUS PATTERN (MANDATORY):**
```typescript
// CONTEXT7 SOURCE: /typescript/handbook - Direct JSON imports for static content
// ARCHITECTURE REASON: Synchronous data availability prevents loading state failures
import cmsContent from '../../content/cms-content.json';
import type { CMSContentType } from '../../types/cms-types';

// MANDATORY: All CMS functions MUST be synchronous
export const getCMSContent = (): CMSContentType => {
  return cmsContent;
};

// MANDATORY: Direct function calls without loading states
const content = getCMSContent();
const aboutSection = content.homepage.about;
```

**❌ ABSOLUTELY FORBIDDEN ASYNC PATTERNS - CAUSE COMPLETE FAILURE:**
```typescript
// FORBIDDEN: These patterns caused homepage failure
export const loadCachedContent = async (): Promise<any> => { /* FORBIDDEN */ }
const [content, setContent] = useState(null); // FORBIDDEN FOR STATIC DATA
useEffect(() => { loadContent() }, []); // FORBIDDEN FOR CMS DATA
const data = await getCMSContent(); // FORBIDDEN FOR STATIC CONTENT
```

### 🚫 FAILURE SYMPTOMS - IMMEDIATE ARCHITECTURE VIOLATION INDICATORS
If ANY of these symptoms appear, CMS architecture has been violated:
- Loading spinners that never resolve
- "Cannot read properties of undefined" errors
- ".map is not a function" errors from Promise objects
- useState/useEffect for static JSON content loading
- Missing homepage sections (About, Trust Indicators, Schools)
- Eternal loading states for content that should be immediate

### 🎯 MANDATORY ARCHITECTURE RULES - NO EXCEPTIONS

1. **DIRECT JSON IMPORTS ONLY**: 
   ```typescript
   import data from '../../content/file.json'; // ✅ CORRECT
   // NOT: await import() or dynamic loading // ❌ FORBIDDEN
   ```

2. **SYNCHRONOUS FUNCTIONS EXCLUSIVELY**:
   ```typescript
   export const getData = (): Type => data.field; // ✅ CORRECT
   // NOT: export const getData = async (): Promise<Type> // ❌ FORBIDDEN
   ```

3. **NO LOADING STATES FOR STATIC CONTENT**:
   ```typescript
   const content = getCMSContent(); // ✅ CORRECT - Immediate availability
   // NOT: const [content, setContent] = useState(null); // ❌ FORBIDDEN
   ```

4. **NO USEEFFECT FOR CMS DATA**:
   ```typescript
   // ✅ CORRECT - Direct usage in component
   function Component() {
     const data = getCMSContent();
     return <div>{data.content}</div>;
   }
   
   // ❌ FORBIDDEN - useEffect for static data
   useEffect(() => { loadCMSData() }, []);
   ```

### 🔴 EMERGENCY RECOVERY PROTOCOL
If homepage loading failures occur:

1. **IMMEDIATE DIAGNOSIS**:
   - Check for async CMS function signatures
   - Look for useState/useEffect in content loading
   - Verify Promise objects being passed to .map()
   - Confirm loading states for static content

2. **RECOVERY STEPS**:
   - Convert ALL CMS functions to synchronous patterns
   - Replace dynamic imports with direct JSON imports
   - Remove ALL useState/useEffect for static content
   - Eliminate loading spinners for CMS data
   - Test immediate data availability

3. **VERIFICATION CHECKLIST**:
   - [ ] All CMS functions return data immediately
   - [ ] No Promise objects in component props
   - [ ] No loading states for static content
   - [ ] Homepage sections load without delay
   - [ ] Performance <600ms page load

### 📈 PERFORMANCE BENEFITS OF SYNCHRONOUS ARCHITECTURE
- **Immediate Data Availability**: No loading delays for static content
- **Simplified Component Logic**: No loading state management required
- **Better User Experience**: Instant content rendering without spinners
- **Reduced Bundle Size**: No async state management overhead
- **Predictable Behaviour**: Synchronous execution prevents race conditions

## ⚡ TIER 1: IMPLEMENTATION WORKFLOW

### 📋 Pre-Development Checklist
1. Identify appropriate agent for task complexity
2. Retrieve Context7 MCP documentation for all dependencies
3. Verify implementation patterns against official docs
4. Prepare agent context with relevant documentation

### 🔄 MANDATORY DEVELOPMENT PROCESS FOR ALL CODE CHANGES
EVERY code change (new implementations, revisions, updates, refactoring, bug fixes) MUST follow:

1. **Context7 Resolution**: `mcp__context7__resolve-library-id` for library identification
2. **Documentation Retrieval**: `mcp__context7__get-library-docs` for official patterns  
3. **Pattern Verification**: Confirm exact official approach for the specific change needed
4. **Agent Delegation**: Route to appropriate agent with Context7 documentation
5. **Implementation/Revision**: Follow official patterns with mandatory source comments
6. **Verification**: Ensure Context7 compliance and source attribution for ALL changes

### 🚨 PRE-CHANGE VALIDATION CHECKLIST
Before making ANY code modification:
- [ ] Context7 MCP documentation retrieved for relevant libraries
- [ ] Official pattern identified for the specific change type
- [ ] Exact documentation section/version noted for citation
- [ ] Logic justification prepared based on official guidance  
- [ ] Comment format prepared with Context7 source and reasoning

### 📁 File Management Protocol
- **PRECISION SCOPE**: Execute exactly what's requested, nothing more
- **EDIT-FIRST POLICY**: Prefer modifying existing files over creating new ones
- **NO PROACTIVE DOCS**: Only create documentation when explicitly requested
- **NECESSITY GATE**: New files only when absolutely essential for goal achievement

## 🎯 TIER 2: CONTEXT7 MCP INTEGRATION

### 🔍 Documentation Retrieval Strategy
```
MANDATORY WORKFLOW:
1. mcp__context7__resolve-library-id(libraryName: "target-library")
2. mcp__context7__get-library-docs(context7CompatibleLibraryID: "/resolved/id")
3. Implement following official patterns only
4. Add Context7 source comments to all implementations
```

### 📝 MANDATORY REVISION COMMENT STANDARDS
ALL code changes (implementations, revisions, modifications, updates, refactoring, bug fixes) MUST include Context7 source citations:

```typescript
// CONTEXT7 SOURCE: /radix-ui/primitives - Button with asChild pattern for polymorphic components
// REVISION REASON: Official Radix UI documentation Section 3.2 recommends Slot pattern for multiple children handling
// CONTEXT7 SOURCE: /framer/motion - LazyMotion configuration without strict mode
// BUG FIX REASON: Official Framer Motion docs v10.16.1 specify strict:false prevents React.Children.only errors
// CONTEXT7 SOURCE: /vercel/next.js - App Router dynamic rendering patterns
// REFACTOR REASON: Next.js 15.0 documentation mandates force-dynamic in layout.tsx for client-side routing
```

### 🔍 REVISION COMMENT FORMAT (MANDATORY)
Every code change, including single-line modifications, MUST include:
1. **CONTEXT7 SOURCE**: `/library/project - specific pattern/feature name`
2. **CHANGE TYPE**: Implementation/Revision/Update/Refactoring/Bug Fix + REASON
3. **DOCUMENTATION REFERENCE**: Exact section, version, or specific guidance followed
4. **LOGIC JUSTIFICATION**: WHY this approach based on official documentation

### 🚫 FORBIDDEN SOURCES FOR ALL CODE CHANGES
ZERO TOLERANCE - These sources are NEVER acceptable for ANY code change:
- External documentation websites (even official ones outside Context7 MCP)
- Community tutorials or blog posts
- Stack Overflow or GitHub issue solutions  
- Unofficial examples or implementations
- General knowledge, memory, or assumptions
- "Quick fixes" without documentation backing
- "Common patterns" without official source
- Previous experience or industry standards without Context7 verification

## ❌ ABSOLUTELY FORBIDDEN ARCHITECTURAL PATTERNS - HOMEPAGE FAILURE PREVENTION

### 🚨 ZERO TOLERANCE CMS ANTI-PATTERNS - CAUSE COMPLETE SYSTEM FAILURE
**CONTEXT**: These patterns caused critical homepage failure requiring emergency recovery (August 2025)
**IMPACT**: Loading states never resolved, missing content sections, ".map is not a function" errors
**RECOVERY**: Successfully restored by converting to synchronous patterns

**❌ FORBIDDEN ASYNC CMS PATTERNS - IMMEDIATE TERMINATION:**
```typescript
// FORBIDDEN: loadCachedContent function signature
export const loadCachedContent = async (): Promise<any> => {
  // This pattern caused homepage failure - NEVER USE
};

// FORBIDDEN: Dynamic file loading for static content
const content = await import('../../content/cms-content.json');

// FORBIDDEN: Promise-based CMS functions
export const getCMSContent = (): Promise<ContentType> => {
  return Promise.resolve(data); // CAUSED HOMEPAGE FAILURE
};

// FORBIDDEN: useState for static JSON content
const [cmsContent, setCmsContent] = useState(null);
const [loading, setLoading] = useState(true);

// FORBIDDEN: useEffect for static CMS data
useEffect(() => {
  const loadContent = async () => {
    const data = await getCMSData(); // CAUSED COMPLETE FAILURE
    setContent(data);
  };
  loadContent();
}, []);

// FORBIDDEN: Loading spinners for static content
if (loading) return <div>Loading...</div>; // NEVER RESOLVES

// FORBIDDEN: .then() patterns on CMS functions
getCMSContent().then(data => setContent(data)); // CAUSED FAILURE
```

**❌ FORBIDDEN COMPONENT PATTERNS - PREVENT THESE AT ALL COSTS:**
```typescript
// FORBIDDEN: Async data loading in components
const HomePage = () => {
  const [aboutData, setAboutData] = useState(null);
  const [schoolsData, setSchoolsData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    loadHomepageData(); // CAUSED COMPLETE HOMEPAGE FAILURE
  }, []);
  
  return loading ? <Spinner /> : <Content />; // ETERNAL LOADING
};
```

### 🛡️ ANTI-PATTERN DETECTION CHECKLIST - PREVENT HOMEPAGE FAILURES
IMMEDIATELY REJECT any code containing:

- [ ] ❌ `async` keyword in CMS function signatures
- [ ] ❌ `Promise<>` return types for static content functions
- [ ] ❌ `useState()` hooks for JSON content loading
- [ ] ❌ `useEffect()` hooks for CMS data fetching
- [ ] ❌ `await` keywords for static content access
- [ ] ❌ `.then()` method calls on CMS functions
- [ ] ❌ Loading spinners for static JSON data
- [ ] ❌ Dynamic `import()` statements for content files
- [ ] ❌ `loadCachedContent` function name patterns
- [ ] ❌ Conditional rendering based on loading states for static data

### 🔴 EMERGENCY ARCHITECTURE VIOLATION RESPONSE
**IF ANY FORBIDDEN PATTERN IS DETECTED:**

1. **IMMEDIATE HALT**: Stop all development work
2. **PATTERN IDENTIFICATION**: Document which forbidden pattern was found
3. **IMPACT ASSESSMENT**: Check for homepage loading failures
4. **SYNCHRONOUS CONVERSION**: Convert to proven working patterns
5. **VERIFICATION**: Test immediate data availability
6. **DOCUMENTATION UPDATE**: Record lesson learned in CLAUDE.md

### ⚠️ REVISION ENFORCEMENT RULES
- **SINGLE LINE CHANGES**: Even one-character modifications require Context7 documentation
- **CSS TWEAKS**: All styling changes must reference official framework documentation
- **BUG FIXES**: Must cite official troubleshooting or error handling patterns
- **REFACTORING**: Must reference official best practices for the specific transformation
- **PERFORMANCE OPTIMISATION**: Must cite official performance guidelines
- **ACCESSIBILITY FIXES**: Must reference WCAG guidelines via Context7 MCP

## 🏛️ TIER 3: AGENT SPECIALISATION MATRIX

### ⚡ Haiku Agent (Fast, Efficient)
**Optimal For**: Content updates, CSS tweaks, simple component changes, documentation updates, bug fixes
**Context Required**: Minimal - current file context, specific change requirements, AND relevant Context7 MCP documentation
**MANDATORY**: ALL changes require Context7 documentation retrieval and source comments
**Output Expected**: Quick, precise modifications with Context7 source comments and change reasoning

### ⚖️ Sonnet Agent (Balanced, Complex)
**Optimal For**: Component architecture, API integrations, form implementations, state management, testing suites
**Context Required**: Moderate - relevant Context7 docs, component relationships, business requirements
**MANDATORY**: ALL implementations, modifications, and refactoring require Context7 MCP documentation
**Output Expected**: Well-structured implementations following official patterns with comprehensive source citations

### 🧠 Opus Agent (Advanced, Strategic)
**Optimal For**: System architecture, performance optimisation, accessibility compliance, security implementations, complex business logic
**Context Required**: Comprehensive - full Context7 documentation, system architecture, business context
**MANDATORY**: ALL architectural decisions, optimisations, and security implementations require Context7 MCP backing
**Output Expected**: Enterprise-grade solutions with detailed Context7 pattern justification and extensive source documentation

## 🔧 TIER 4: WORKFLOW OPTIMISATION

### 📊 Task Classification
- **Simple** → Haiku → Quick execution with minimal context
- **Complex** → Sonnet → Structured implementation with moderate context
- **Strategic** → Opus → Comprehensive solution with full context

### 🎯 Context Preparation
- Retrieve all relevant Context7 MCP documentation before agent invocation
- Prepare project-specific requirements and constraints
- Include business context for premium tutoring service standards
- Specify British English and royal client quality expectations

### ✅ OUTPUT VERIFICATION - CONTEXT7 COMPLIANCE MANDATORY
EVERY code change must pass these verification checks:
- **Context7 MCP Pattern Compliance**: All changes follow official documentation patterns
- **Mandatory Source Comments**: Context7 source citations present for ALL modifications
- **Documentation Traceability**: Logic can be traced back to specific official guidance
- **Change Type Documentation**: Clear reasoning for revision/update/refactoring approach
- **British English Usage**: Consistent throughout all implementations
- **Premium Service Standards**: Royal client-worthy quality maintained

### 🔴 IMMEDIATE TERMINATION CONDITIONS
These violations result in immediate task termination:
- Any code change without Context7 MCP documentation backing
- Missing source comments on any modification (including single-line changes)  
- Use of external sources, tutorials, or "common knowledge" for implementation decisions
- Quick fixes or shortcuts without official documentation verification
- Assumptions about best practices without Context7 MCP confirmation
- **ANY ASYNC CMS PATTERNS**: Promise-based functions, useState/useEffect for static content
- **ANY FORBIDDEN ARCHITECTURAL PATTERNS**: Dynamic imports, loading states for JSON data
- **ANY HOMEPAGE FAILURE INDICATORS**: Loading spinners that don't resolve, missing content sections

---

# 🎓 PROJECT: MY PRIVATE TUTOR ONLINE - PREMIUM REDESIGN 2025

## 🎯 PROJECT CONTEXT
**Business**: Premium tutoring service with royal endorsements, serving elite families
**Heritage**: 15 years established (2010), featured in Tatler Address Book 2025
**Standards**: Royal client quality, enterprise-grade implementations, British English

## 📊 CURRENT STATUS - ENHANCED PRODUCTION READY
✅ **Vercel Deployment**: Dynamic rendering configured with 91 optimized routes
✅ **React.Children.only**: Radix UI Slot patterns resolved with React 19 compatibility
✅ **Content Updates**: Royal endorsement branding + 30 client photos integrated
✅ **Image Management**: Complete CMS integration with kebab-case naming system
✅ **Navigation Enhancement**: Hover dropdowns with nested submenu structure
✅ **Testimonials System**: 7 new testimonials integrated with structured CMS format
✅ **Page Components**: Homepage form/about restoration + tier layout spotlight design
✅ **Video Assets**: All paths optimised in /public/videos/ with hero integration
✅ **Trust Indicators**: Updated with 2025 recognition + strategic image placement
✅ **Blog System**: Professional under-construction page with premium branding
✅ **Admin Dashboard**: 85% operational status with comprehensive security audit  

## 🎯 TARGET DEMOGRAPHICS
- **Oxbridge Prep**: Affluent families, prestigious university entry
- **11+ Parents**: Grammar school preparation, reassurance-focused
- **A-Level/GCSE**: Immediate solutions, results-driven
- **Elite Corporate**: Ultra-wealthy, discretion required, bespoke service
- **Comparison Shoppers**: Logic-driven, service comparison analysis

## ⚡ ENHANCED TECHNICAL SPECIFICATIONS - POST RECOVERY UPDATE
- **Performance**: <1.5s load times, 229kB first load JS, 91 optimized routes
- **Build System**: <25 second build time with React 19 compatibility
- **Design**: Mobile-first responsive, accessibility WCAG 2.1 AA, premium image integration
- **Architecture**: Next.js 15.4.6 App Router, React 19, TypeScript 5.8.3+ - SYNCHRONOUS CMS MANDATORY
- **Navigation**: Enhanced hover dropdowns with nested submenu architecture
- **CMS**: SYNCHRONOUS ARCHITECTURE - Advanced image management with kebab-case naming and strategic placement
- **Content**: 30 client photos + 7 new testimonials with structured data format - IMMEDIATE LOADING
- **Features**: Booking system, progress tracking, payment integration, tier layout spotlight design
- **Admin**: 85% operational dashboard with comprehensive security and error handling
- **RECOVERY STATUS**: Homepage fully operational with synchronous CMS patterns - 558ms load times verified

---

# 🏗️ TECHNICAL IMPLEMENTATION STANDARDS

## 🚀 Architecture Foundation
- **Tech Stack**: Next.js 15+ App Router, React 19, TypeScript 5.3+, Tailwind CSS 4.x
- **State Management**: Zustand for client state, React Server Components for data
- **Form Handling**: React Hook Form + Zod validation, accessibility-first
- **Performance**: LCP <2.5s, FID <100ms, CLS <0.1, bundle <150kB gzipped

## 🎨 Design System & UI
- **Colour Scheme**: Navy (#0f172a), Gold accent (#eab308), white backgrounds
- **Typography**: Font-serif headings, font-sans body, consistent hierarchy
- **Component Libraries**: Radix UI + Tailwind (Shadcn/UI), accessibility-first selection
- **Variants**: Class Variance Authority (CVA) for component styling
- **Tokens**: Centralised design tokens for spacing, colours, typography

## 📊 Content Management System - SYNCHRONOUS ARCHITECTURE MANDATORY

### 🚨 CRITICAL CMS ARCHITECTURE RULES - HOMEPAGE RECOVERY VERIFIED
- **Architecture**: Centralised CMS via cms-content.ts and cms-images.ts - SYNCHRONOUS ONLY
- **Direct JSON Imports**: All content loaded via direct imports from /src/content/
- **Zero Async Patterns**: NO Promise-based functions, NO useEffect for static data
- **Immediate Availability**: All CMS data accessible without loading states
- **Zero Hardcoding**: All content, images, contact details via synchronous CMS functions
- **Comment Standard**: `// CMS DATA SOURCE: Using [function] for [purpose] - SYNCHRONOUS PATTERN`
- **Configuration**: settings.json for global config, structured metadata - DIRECT IMPORT ONLY

### ✅ PROVEN WORKING CMS IMPLEMENTATION PATTERNS

**MANDATORY CMS File Structure:**
```
/src/content/
├── cms-content.json     // Direct import source
├── cms-images.json      // Direct import source  
├── testimonials.json    // Direct import source
└── settings.json        // Direct import source

/src/lib/cms/
├── cms-content.ts       // Synchronous getter functions
├── cms-images.ts        // Synchronous getter functions
└── cms-types.ts         // TypeScript definitions
```

**MANDATORY Function Signatures:**
```typescript
// ✅ CORRECT - Synchronous CMS functions
export const getHomepageContent = (): HomepageContent => {
  return cmsContent.homepage;
};

export const getTestimonials = (): TestimonialType[] => {
  return testimonialsData.testimonials;
};

export const getSchools = (): SchoolType[] => {
  return cmsContent.schools;
};

// ❌ FORBIDDEN - Async patterns that caused homepage failure
export const loadHomepageContent = async (): Promise<HomepageContent> => { /* FORBIDDEN */ }
export const getCachedContent = (): Promise<any> => { /* FORBIDDEN */ }
```

### 🔒 CMS USAGE IN COMPONENTS - MANDATORY PATTERNS

**✅ CORRECT Component Implementation:**
```typescript
'use client';

import { getHomepageContent, getTestimonials } from '@/lib/cms/cms-content';

export default function HomePage() {
  // CMS DATA SOURCE: Using getHomepageContent for homepage sections - SYNCHRONOUS PATTERN
  const content = getHomepageContent();
  const testimonials = getTestimonials();
  
  return (
    <div>
      <section>{content.hero.title}</section>
      <section>{content.about.description}</section>
      {testimonials.map((testimonial) => (
        <div key={testimonial.id}>{testimonial.text}</div>
      ))}
    </div>
  );
}
```

**❌ FORBIDDEN Async Component Patterns:**
```typescript
// THESE PATTERNS CAUSED COMPLETE HOMEPAGE FAILURE
const [content, setContent] = useState(null);
const [loading, setLoading] = useState(true);

useEffect(() => {
  const loadData = async () => {
    const data = await getCMSContent(); // FORBIDDEN
    setContent(data);
    setLoading(false);
  };
  loadData();
}, []);

if (loading) return <div>Loading...</div>; // FORBIDDEN FOR STATIC DATA
```

## ♿ Accessibility & UX (WCAG 2.1 AA Mandatory)
- **Motion Sensitivity**: `prefers-reduced-motion` support required
- **Keyboard Navigation**: Complete keyboard accessibility, focus management
- **Semantic HTML**: Proper heading hierarchy, ARIA labels, semantic elements
- **Testing**: axe-core integration, automated accessibility validation

## 🔧 Quality Assurance
- **Testing Stack**: Vitest (unit), Playwright (E2E), axe-core (accessibility)
- **Performance**: Bundle analysis, Web Vitals tracking, real user monitoring
- **Security**: JWT authentication, HTTP-only cookies, Zod input validation
- **Documentation**: Common issues and solutions in codebase

## 🚀 CI/CD Performance Monitoring (AUGUST 2025 - DEPLOYED)
- **GitHub Actions Pipelines**: Automated performance testing with Lighthouse CI
- **Performance Gates**: Deployment blocking for budget violations and regressions
- **Budget Enforcement**: Automated validation of resource and timing budgets
- **Continuous Monitoring**: 24/7 performance monitoring with alerting system
- **Vercel Integration**: Deployment protection with performance check requirements
- **Royal Standards**: Premium service performance metrics maintained automatically

## 📐 Component Standards
- **Architecture**: PageLayout → PageHero → Section structure
- **Background Control**: Explicit background='white' in PageLayout
- **Responsive Design**: Mobile-first, proper breakpoint strategy
- **Pattern Documentation**: CUSTOM_DOCS.md for proven implementations

## 🔄 Development Workflow
- **Version Control**: Conventional commits, logical change grouping
- **Branch Strategy**: Main/develop/feature model for production service
- **Deployment**: Complete checklist with security review
- **Admin Experience**: User-friendly interfaces with comprehensive guides

---

# 🚀 PRODUCTION DEPLOYMENT PATTERNS - AUGUST 2025

## ⚡ Vercel Dynamic Architecture (Proven Solution)
- **Global Force-Dynamic**: `export const dynamic = 'force-dynamic'` in layout.tsx only
- **Client Components**: All pages use "use client" directive for Framer Motion compatibility
- **No Page-Level Export**: Avoid redundant force-dynamic exports in individual pages
- **Static Export Removal**: Eliminate all static export configurations from next.config.ts

## 🔧 React.Children.only Resolution (Radix UI Patterns)
```typescript
// CONTEXT7 SOURCE: /radix-ui/primitives - Slot composition pattern
import { Root as Slot, Slottable } from "@radix-ui/react-slot"

// Multiple children handling
{asChild ? (
  <Slot>
    <Slottable>{children}</Slottable>
  </Slot>
) : (
  children
)}
```

## 🎯 Component Architecture Standards - POST RECOVERY VERIFIED
- **Modular Sections**: Extract homepage sections (ResultsSection, HomepageHowItWorks) - SYNCHRONOUS DATA ONLY
- **Flexible Props**: title, description, backgroundColor, className with sensible defaults
- **Context7 Comments**: Every component includes MCP documentation references
- **Semantic Selection**: Image mapping based on content context, not rotation
- **MANDATORY CMS PATTERN**: Direct function calls without loading states
- **NO ASYNC COMPONENTS**: All homepage components use synchronous data access
- **IMMEDIATE RENDERING**: No conditional rendering based on loading states for static content

## 📊 Performance Validation - POST RECOVERY METRICS
- **Bundle Size**: First Load JS ~229kB homepage, build time <15 seconds
- **Routing**: All routes ƒ (Dynamic) server-rendered on demand
- **Video Assets**: All served from /public/videos/ with CMS integration
- **Section Spacing**: Consistent padding prevents double spacing
- **HOMEPAGE LOAD TIME**: 558ms verified (August 2025 recovery)
- **CONTENT AVAILABILITY**: 100% immediate loading without spinners
- **ERROR RATE**: Zero ".map is not a function" errors after synchronous conversion
- **USER EXPERIENCE**: No loading delays for static content sections

## 🔄 Deployment Protocol
- **Build Verification**: `npm run build` locally before deployment + CMS SYNCHRONOUS VERIFICATION
- **Production Deploy**: `vercel --prod` for production releases
- **Cache Issues**: Delete/recreate Vercel project if persistent problems
- **HOMEPAGE VERIFICATION**: Test all sections load immediately without spinners
- **CMS AUDIT**: Verify no async patterns before deployment
- **Production URL**: https://myprivatetutoronline-991oq6we4-jacks-projects-cf5effed.vercel.app

---

# 📚 CUSTOM PATTERN LIBRARY - MAINTAIN IN CUSTOM_DOCS.md
Document all Context7-verified patterns for rapid implementation reference.

---

# 🚑 EMERGENCY PROTOCOLS - HOMEPAGE FAILURE PREVENTION & RECOVERY

## 🚨 HOMEPAGE FAILURE EMERGENCY RESPONSE PROTOCOL
**ACTIVATION TRIGGERS**: Any homepage loading failures, missing sections, eternal loading spinners

### 🔄 IMMEDIATE DIAGNOSIS CHECKLIST
When homepage fails to load properly:

1. **IDENTIFY ASYNC VIOLATIONS**:
   - [ ] Check for `async` keywords in CMS functions
   - [ ] Look for `Promise<>` return types
   - [ ] Find `useState()` hooks for static content
   - [ ] Locate `useEffect()` hooks for CMS data
   - [ ] Search for loading spinners on static content

2. **ERROR PATTERN RECOGNITION**:
   - [ ] ".map is not a function" - Promises passed to array methods
   - [ ] "Cannot read properties of undefined" - Loading states not resolved
   - [ ] Missing About section - CMS data not loading
   - [ ] Missing Schools carousel - Array data not available
   - [ ] Eternal loading spinners - Async functions hanging

3. **ARCHITECTURE AUDIT**:
   - [ ] Verify all CMS imports are direct JSON imports
   - [ ] Confirm all CMS functions are synchronous
   - [ ] Check component data access patterns
   - [ ] Validate immediate data availability

### ⚙️ RECOVERY CONVERSION STEPS

**STEP 1: CONVERT CMS FUNCTIONS TO SYNCHRONOUS**
```typescript
// BEFORE (BROKEN):
export const loadCachedContent = async (): Promise<any> => {
  // This caused the failure
};

// AFTER (WORKING):
import cmsContent from '../../content/cms-content.json';
export const getCMSContent = (): CMSContentType => {
  return cmsContent;
};
```

**STEP 2: REPLACE DYNAMIC IMPORTS WITH DIRECT IMPORTS**
```typescript
// BEFORE (BROKEN):
const content = await import('../../content/cms-content.json');

// AFTER (WORKING):
import content from '../../content/cms-content.json';
```

**STEP 3: ELIMINATE LOADING STATES FOR STATIC CONTENT**
```typescript
// BEFORE (BROKEN):
const [content, setContent] = useState(null);
const [loading, setLoading] = useState(true);

// AFTER (WORKING):
const content = getCMSContent(); // Immediate availability
```

**STEP 4: REMOVE USEEFFECT FOR CMS DATA**
```typescript
// BEFORE (BROKEN):
useEffect(() => {
  loadCMSData().then(setContent);
}, []);

// AFTER (WORKING):
const content = getCMSContent(); // Direct function call
```

### ✅ RECOVERY VERIFICATION CHECKLIST
After implementing synchronous patterns:

1. **IMMEDIATE FUNCTIONALITY TEST**:
   - [ ] Homepage loads without loading spinners
   - [ ] All sections appear immediately (Hero, About, Schools, Testimonials)
   - [ ] No ".map is not a function" errors in console
   - [ ] No "Cannot read properties" errors
   - [ ] Page load time <1 second

2. **CMS FUNCTION VERIFICATION**:
   - [ ] All CMS functions return data immediately
   - [ ] No `async` keywords in CMS function signatures
   - [ ] No `Promise<>` return types
   - [ ] Direct JSON imports only
   - [ ] Functions callable without `await`

3. **COMPONENT VERIFICATION**:
   - [ ] No useState for static content loading
   - [ ] No useEffect for CMS data fetching
   - [ ] Direct function calls in components
   - [ ] Immediate data availability
   - [ ] No conditional rendering based on loading states

4. **PERFORMANCE VERIFICATION**:
   - [ ] HTTP 200 responses
   - [ ] Load time <600ms
   - [ ] All content sections visible
   - [ ] No JavaScript errors
   - [ ] Responsive design working

### 📝 RECOVERY SUCCESS DOCUMENTATION
After successful recovery, document:

1. **Root Cause**: What async pattern caused the failure
2. **Impact**: Which sections/functionality were affected
3. **Solution**: Exact synchronous pattern implemented
4. **Prevention**: How to avoid this pattern in future
5. **Verification**: Performance metrics after recovery

### 🔥 PREVENTION MEASURES - NEVER REPEAT FAILURES

1. **CODE REVIEW CHECKLIST**: Reject any code containing forbidden async patterns
2. **ARCHITECTURAL GUIDELINES**: Mandatory synchronous CMS documentation
3. **TESTING PROTOCOLS**: Verify immediate data availability in all components
4. **DEVELOPMENT STANDARDS**: Context7 MCP compliance for all CMS changes
5. **MONITORING**: Regular homepage functionality audits

**REMEMBER**: The synchronous CMS architecture is PROVEN WORKING. Any deviation risks complete homepage failure.