<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Viewport Solution Testing</title>
    <style>
        /* CONTEXT7 SOURCE: /mdn/content - CSS Grid layout for test dashboard organization */
        /* TEST_DASHBOARD_REASON: Official CSS Grid documentation for comprehensive testing interface */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #334155;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .test-header {
            background: #0f172a;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .test-header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .test-status {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.9;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .test-section {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .test-section-header {
            background: #f1f5f9;
            padding: 12px 16px;
            font-weight: 600;
            font-size: 14px;
            color: #475569;
            border-bottom: 1px solid #e2e8f0;
        }

        .test-content {
            padding: 16px;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-label {
            font-size: 13px;
            color: #64748b;
        }

        .test-value {
            font-family: monospace;
            font-size: 12px;
            background: #f8fafc;
            padding: 2px 6px;
            border-radius: 3px;
            color: #0f172a;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-pass { background: #10b981; }
        .status-fail { background: #ef4444; }
        .status-warning { background: #f59e0b; }
        .status-pending { background: #6b7280; }

        .iframe-container {
            width: 100%;
            height: 300px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .test-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .breakpoint-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .breakpoint-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .breakpoint-btn:hover {
            background: #f3f4f6;
        }

        .breakpoint-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .console-output {
            background: #1f2937;
            color: #e5e7eb;
            padding: 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .measurement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 12px;
        }

        .measurement-item {
            text-align: center;
            padding: 8px;
            background: #f8fafc;
            border-radius: 4px;
        }

        .measurement-value {
            font-size: 16px;
            font-weight: 600;
            color: #0f172a;
        }

        .measurement-label {
            font-size: 11px;
            color: #64748b;
            margin-top: 2px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
            width: 0%;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>My Private Tutor Online - Comprehensive Viewport Testing</h1>
            <div class="test-status">
                Dynamic Viewport Units (DVH) + Scrollbar-Gutter Implementation
                <br>
                <span id="testProgress">Initializing comprehensive test suite...</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>

        <div class="test-grid">
            <!-- Browser Support Detection -->
            <div class="test-section">
                <div class="test-section-header">Browser Support Detection</div>
                <div class="test-content">
                    <div class="test-item">
                        <span class="test-label">Dynamic Viewport Height (dvh)</span>
                        <span class="test-value" id="dvhSupport">Testing...</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Scrollbar Gutter</span>
                        <span class="test-value" id="scrollbarGutterSupport">Testing...</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Viewport Units Support</span>
                        <span class="test-value" id="viewportUnitsSupport">Testing...</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">CSS.supports API</span>
                        <span class="test-value" id="cssSupportsAPI">Testing...</span>
                    </div>
                </div>
            </div>

            <!-- Viewport Measurements -->
            <div class="test-section">
                <div class="test-section-header">Viewport Measurements</div>
                <div class="test-content">
                    <div class="measurement-grid">
                        <div class="measurement-item">
                            <div class="measurement-value" id="viewportWidth">--</div>
                            <div class="measurement-label">Width (px)</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-value" id="viewportHeight">--</div>
                            <div class="measurement-label">Height (px)</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-value" id="dvhHeight">--</div>
                            <div class="measurement-label">100dvh (px)</div>
                        </div>
                        <div class="measurement-item">
                            <div class="measurement-value" id="vhHeight">--</div>
                            <div class="measurement-label">100vh (px)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Breakpoint Testing -->
            <div class="test-section">
                <div class="test-section-header">Responsive Breakpoint Testing</div>
                <div class="test-content">
                    <div class="breakpoint-controls">
                        <button class="breakpoint-btn" data-width="375" data-height="667">Mobile (375px)</button>
                        <button class="breakpoint-btn" data-width="768" data-height="1024">Tablet (768px)</button>
                        <button class="breakpoint-btn" data-width="1024" data-height="768">Large (1024px)</button>
                        <button class="breakpoint-btn" data-width="1280" data-height="720">XL (1280px)</button>
                        <button class="breakpoint-btn" data-width="1920" data-height="1080">Desktop (1920px)</button>
                    </div>
                    <div class="iframe-container">
                        <iframe id="testIframe" src="http://localhost:3000" class="test-iframe"></iframe>
                    </div>
                </div>
            </div>

            <!-- Navbar Height Testing -->
            <div class="test-section">
                <div class="test-section-header">Navbar Height Calculations</div>
                <div class="test-content">
                    <div class="test-item">
                        <span class="test-label">Mobile (5.5rem)</span>
                        <span class="test-value" id="navbarMobile">88px</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Tablet (6.25rem)</span>
                        <span class="test-value" id="navbarTablet">100px</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Desktop (7rem)</span>
                        <span class="test-value" id="navbarDesktop">112px</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Remaining Viewport</span>
                        <span class="test-value" id="remainingViewport">Calculating...</span>
                    </div>
                </div>
            </div>

            <!-- Layout Stability Testing -->
            <div class="test-section">
                <div class="test-section-header">Layout Stability</div>
                <div class="test-content">
                    <div class="test-item">
                        <span class="test-label">Horizontal Overflow</span>
                        <span class="test-value" id="horizontalOverflow">Testing...</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Scrollbar Layout Shift</span>
                        <span class="test-value" id="scrollbarShift">Testing...</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Content Jump</span>
                        <span class="test-value" id="contentJump">Testing...</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">Full-width Sections</span>
                        <span class="test-value" id="fullWidthSections">Testing...</span>
                    </div>
                </div>
            </div>

            <!-- Console Output -->
            <div class="test-section">
                <div class="test-section-header">Console Output & Errors</div>
                <div class="test-content">
                    <div class="console-output" id="consoleOutput">
Initializing comprehensive viewport testing...
Checking browser capabilities...
Testing responsive breakpoints...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONTEXT7 SOURCE: /mdn/content - Comprehensive viewport testing implementation
        // VIEWPORT_TESTING_REASON: Official Web APIs documentation for viewport measurement and testing

        class ViewportTester {
            constructor() {
                this.testResults = {};
                this.currentBreakpoint = null;
                this.testProgress = 0;
                this.totalTests = 8;
                this.consoleOutput = document.getElementById('consoleOutput');
                this.init();
            }

            init() {
                this.log('🚀 Starting comprehensive viewport testing...');
                this.setupBreakpointControls();
                this.runInitialTests();
                this.startContinuousMonitoring();
            }

            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                this.consoleOutput.textContent += `[${timestamp}] ${message}\n`;
                this.consoleOutput.scrollTop = this.consoleOutput.scrollHeight;
                console.log(message);
            }

            updateProgress() {
                this.testProgress++;
                const percentage = (this.testProgress / this.totalTests) * 100;
                document.getElementById('progressBar').style.width = `${percentage}%`;
                document.getElementById('testProgress').textContent =
                    `Testing progress: ${this.testProgress}/${this.totalTests} tests completed (${Math.round(percentage)}%)`;
            }

            // Test 1: Browser Support Detection
            testBrowserSupport() {
                this.log('🔍 Testing browser support for modern CSS features...');

                // Test DVH support
                const dvhSupported = CSS.supports('height', '100dvh');
                document.getElementById('dvhSupport').textContent = dvhSupported ? '✅ Supported' : '❌ Not Supported';
                document.getElementById('dvhSupport').className = 'test-value ' + (dvhSupported ? 'status-pass' : 'status-fail');

                // Test scrollbar-gutter support
                const scrollbarGutterSupported = CSS.supports('scrollbar-gutter', 'stable');
                document.getElementById('scrollbarGutterSupport').textContent = scrollbarGutterSupported ? '✅ Supported' : '❌ Not Supported';
                document.getElementById('scrollbarGutterSupport').className = 'test-value ' + (scrollbarGutterSupported ? 'status-pass' : 'status-fail');

                // Test viewport units support
                const viewportUnitsSupported = CSS.supports('height', '100vh') && CSS.supports('width', '100vw');
                document.getElementById('viewportUnitsSupport').textContent = viewportUnitsSupported ? '✅ Supported' : '❌ Not Supported';

                // Test CSS.supports API
                const cssSupportsAvailable = typeof CSS !== 'undefined' && typeof CSS.supports === 'function';
                document.getElementById('cssSupportsAPI').textContent = cssSupportsAvailable ? '✅ Available' : '❌ Not Available';

                this.testResults.browserSupport = {
                    dvh: dvhSupported,
                    scrollbarGutter: scrollbarGutterSupported,
                    viewportUnits: viewportUnitsSupported,
                    cssSupports: cssSupportsAvailable
                };

                this.log(`✅ Browser support test completed - DVH: ${dvhSupported}, Scrollbar-Gutter: ${scrollbarGutterSupported}`);
                this.updateProgress();
            }

            // Test 2: Viewport Measurements
            measureViewport() {
                this.log('📏 Measuring viewport dimensions...');

                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                // Create test element to measure DVH
                const testElement = document.createElement('div');
                testElement.style.position = 'absolute';
                testElement.style.top = '-9999px';
                testElement.style.height = '100dvh';
                document.body.appendChild(testElement);
                const dvhHeight = testElement.offsetHeight;
                document.body.removeChild(testElement);

                // Measure 100vh
                const testElementVh = document.createElement('div');
                testElementVh.style.position = 'absolute';
                testElementVh.style.top = '-9999px';
                testElementVh.style.height = '100vh';
                document.body.appendChild(testElementVh);
                const vhHeight = testElementVh.offsetHeight;
                document.body.removeChild(testElementVh);

                document.getElementById('viewportWidth').textContent = viewportWidth + 'px';
                document.getElementById('viewportHeight').textContent = viewportHeight + 'px';
                document.getElementById('dvhHeight').textContent = dvhHeight + 'px';
                document.getElementById('vhHeight').textContent = vhHeight + 'px';

                this.testResults.viewport = {
                    width: viewportWidth,
                    height: viewportHeight,
                    dvhHeight: dvhHeight,
                    vhHeight: vhHeight,
                    dvhDifference: Math.abs(dvhHeight - vhHeight)
                };

                this.log(`📏 Viewport measurements: ${viewportWidth}x${viewportHeight}, DVH difference: ${this.testResults.viewport.dvhDifference}px`);
                this.updateProgress();
            }

            // Test 3: Navbar Height Calculations
            testNavbarHeights() {
                this.log('📐 Testing navbar height calculations...');

                const remSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
                const mobileHeight = 5.5 * remSize;
                const tabletHeight = 6.25 * remSize;
                const desktopHeight = 7 * remSize;

                document.getElementById('navbarMobile').textContent = Math.round(mobileHeight) + 'px';
                document.getElementById('navbarTablet').textContent = Math.round(tabletHeight) + 'px';
                document.getElementById('navbarDesktop').textContent = Math.round(desktopHeight) + 'px';

                // Calculate remaining viewport based on current width
                const currentWidth = window.innerWidth;
                let currentNavbarHeight;
                if (currentWidth >= 1280) {
                    currentNavbarHeight = desktopHeight;
                } else if (currentWidth >= 1024) {
                    currentNavbarHeight = tabletHeight;
                } else {
                    currentNavbarHeight = mobileHeight;
                }

                const remainingHeight = this.testResults.viewport.dvhHeight - currentNavbarHeight;
                document.getElementById('remainingViewport').textContent = Math.round(remainingHeight) + 'px';

                this.testResults.navbarHeights = {
                    mobile: mobileHeight,
                    tablet: tabletHeight,
                    desktop: desktopHeight,
                    current: currentNavbarHeight,
                    remaining: remainingHeight
                };

                this.log(`📐 Navbar heights calculated - Current: ${Math.round(currentNavbarHeight)}px, Remaining: ${Math.round(remainingHeight)}px`);
                this.updateProgress();
            }

            // Test 4: Layout Stability
            testLayoutStability() {
                this.log('🔒 Testing layout stability...');

                // Test horizontal overflow
                const bodyOverflowX = getComputedStyle(document.body).overflowX;
                const horizontalOverflowPrevented = bodyOverflowX === 'hidden';
                document.getElementById('horizontalOverflow').textContent = horizontalOverflowPrevented ? '✅ Prevented' : '⚠️ Not Prevented';

                // Test scrollbar gutter implementation
                const htmlScrollbarGutter = getComputedStyle(document.documentElement).scrollbarGutter;
                const scrollbarStabilized = htmlScrollbarGutter === 'stable';
                document.getElementById('scrollbarShift').textContent = scrollbarStabilized ? '✅ Stabilized' : '⚠️ Not Stabilized';

                // Test content jump (simulate by checking if width changes with scrollbar)
                const originalWidth = document.body.clientWidth;
                document.body.style.overflowY = 'scroll';
                const scrollingWidth = document.body.clientWidth;
                document.body.style.overflowY = '';
                const widthDifference = Math.abs(originalWidth - scrollingWidth);
                document.getElementById('contentJump').textContent = widthDifference === 0 ? '✅ No Jump' : `⚠️ ${widthDifference}px Jump`;

                // Test full-width sections (check if any elements cause horizontal scrolling)
                const documentWidth = document.documentElement.scrollWidth;
                const viewportWidth = window.innerWidth;
                const hasHorizontalScroll = documentWidth > viewportWidth;
                document.getElementById('fullWidthSections').textContent = hasHorizontalScroll ? '⚠️ Overflow Detected' : '✅ No Overflow';

                this.testResults.layoutStability = {
                    horizontalOverflowPrevented,
                    scrollbarStabilized,
                    contentJump: widthDifference,
                    fullWidthCompliant: !hasHorizontalScroll
                };

                this.log(`🔒 Layout stability test completed - Content jump: ${widthDifference}px, Horizontal overflow: ${hasHorizontalScroll}`);
                this.updateProgress();
            }

            // Test 5-8: Breakpoint Testing
            setupBreakpointControls() {
                const breakpointButtons = document.querySelectorAll('.breakpoint-btn');
                breakpointButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const width = button.dataset.width;
                        const height = button.dataset.height;
                        this.testBreakpoint(width, height, button.textContent);

                        // Update active state
                        breakpointButtons.forEach(b => b.classList.remove('active'));
                        button.classList.add('active');
                    });
                });
            }

            testBreakpoint(width, height, name) {
                this.log(`📱 Testing ${name} breakpoint: ${width}x${height}`);

                const iframe = document.getElementById('testIframe');
                iframe.style.width = width + 'px';
                iframe.style.height = height + 'px';

                // Wait for iframe to resize, then test
                setTimeout(() => {
                    this.testIframeContent(width, height, name);
                }, 500);
            }

            testIframeContent(width, height, name) {
                try {
                    const iframe = document.getElementById('testIframe');
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                    if (iframeDoc) {
                        // Test if navbar is correctly positioned
                        const navbar = iframeDoc.querySelector('nav') || iframeDoc.querySelector('[role="navigation"]');

                        // Test if hero section uses correct height calculation
                        const heroSection = iframeDoc.querySelector('#hero-premium-tutoring-landing-combined');

                        if (heroSection) {
                            const heroHeight = heroSection.offsetHeight;
                            const expectedHeight = height - this.getNavbarHeightForWidth(width);
                            const heightDifference = Math.abs(heroHeight - expectedHeight);

                            this.log(`📐 ${name} - Hero height: ${heroHeight}px, Expected: ${Math.round(expectedHeight)}px, Difference: ${heightDifference}px`);
                        }

                        this.updateProgress();
                    }
                } catch (error) {
                    this.log(`❌ Error testing ${name} breakpoint: ${error.message}`);
                }
            }

            getNavbarHeightForWidth(width) {
                const remSize = 16; // Assuming 16px rem
                if (width >= 1280) return 7 * remSize;
                if (width >= 1024) return 6.25 * remSize;
                return 5.5 * remSize;
            }

            runInitialTests() {
                setTimeout(() => this.testBrowserSupport(), 100);
                setTimeout(() => this.measureViewport(), 200);
                setTimeout(() => this.testNavbarHeights(), 300);
                setTimeout(() => this.testLayoutStability(), 400);
            }

            startContinuousMonitoring() {
                // Update viewport measurements on resize
                window.addEventListener('resize', () => {
                    this.measureViewport();
                    this.testNavbarHeights();
                });

                // Monitor for console errors
                this.originalConsoleError = console.error;
                console.error = (...args) => {
                    this.log(`❌ Console Error: ${args.join(' ')}`);
                    this.originalConsoleError.apply(console, args);
                };

                // Monitor for console warnings
                this.originalConsoleWarn = console.warn;
                console.warn = (...args) => {
                    this.log(`⚠️ Console Warning: ${args.join(' ')}`);
                    this.originalConsoleWarn.apply(console, args);
                };

                this.log('🔄 Continuous monitoring started...');
            }

            generateReport() {
                this.log('📊 Generating comprehensive test report...');

                const report = {
                    timestamp: new Date().toISOString(),
                    testResults: this.testResults,
                    browser: {
                        userAgent: navigator.userAgent,
                        vendor: navigator.vendor,
                        platform: navigator.platform
                    },
                    recommendations: this.generateRecommendations()
                };

                console.log('📊 COMPREHENSIVE VIEWPORT TEST REPORT:', report);
                return report;
            }

            generateRecommendations() {
                const recommendations = [];

                if (!this.testResults.browserSupport?.dvh) {
                    recommendations.push('Consider implementing additional fallbacks for DVH units in older browsers');
                }

                if (!this.testResults.browserSupport?.scrollbarGutter) {
                    recommendations.push('Implement custom scrollbar width compensation for older browsers');
                }

                if (this.testResults.layoutStability?.contentJump > 0) {
                    recommendations.push(`Address content jump of ${this.testResults.layoutStability.contentJump}px when scrollbars appear`);
                }

                if (!this.testResults.layoutStability?.fullWidthCompliant) {
                    recommendations.push('Fix horizontal overflow in full-width sections');
                }

                if (this.testResults.viewport?.dvhDifference > 50) {
                    recommendations.push('Large difference between DVH and VH detected - verify mobile browser compatibility');
                }

                if (recommendations.length === 0) {
                    recommendations.push('All viewport solutions are working correctly! 🎉');
                }

                return recommendations;
            }
        }

        // Initialize testing when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.viewportTester = new ViewportTester();
        });

        // Generate final report after 10 seconds
        setTimeout(() => {
            if (window.viewportTester) {
                window.viewportTester.generateReport();
            }
        }, 10000);
    </script>
</body>
</html>